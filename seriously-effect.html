
<polymer-element name="seriously-effect">

	<template>
		
		<template if="{{debug}}">
			<!-- TODO: add controls for debug mode! -->
		</template>

	</template>

	<script>


		/**
			
			wrapper for seriously.effect nodes

		*/


		Polymer('seriously-effect', {

			publish: {
				node: {},		// instance of the effect
				type: '',		// type of effect
				sourceID: '', 	// id of input node. used by seriously-graph to connect nodes
				debug: false,	// shows controls for node properties
				_source: {}, 	// the actual Source object. managed by seriously-graph
				_seriously: {}, // instance of Seriously. managed by seriously-graph
			},

			ready: function(){
				this._attrMutationHandler = this._attrMutationHandler.bind(this);
			},

			_sourceChanged: function(){
				// console.log('seriously-effect._sourceChanged');
				this.node.source = this._source;
			},

			_seriouslyChanged: function(){
				// console.log('seriously-effect.seriouslyChanged');
				this.node = this._seriously.effect(this.type); // invalidate node
				this._setupAttributes();
			},

			_setupAttributes: function(){
				var inputs = this.node.inputs();
				console.log(inputs, Object.keys(inputs));

				if(this.attrObserver) this.attrObserver.close();
				this.attrObserver = new MutationObserver(this._attrMutationHandler);
				this.attrObserver.observe(this, {
					attributes: true,
					subtree: false,
					childList: false,
					characterData: false,
					attributeOldValue: false,
					attributeFilter: Object.keys(inputs),
				});
			},

			_attrMutationHandler: function(mutations){
				// console.log('seriously-effect._mutationHandler', mutations);
				for (var i = mutations.length - 1; i >= 0; i--) {
					var m = mutations[i];
					this.node[m.attributeName] = this.attributes[m.attributeName].value;
				};
			},

		});

	</script>

</polymer-element>